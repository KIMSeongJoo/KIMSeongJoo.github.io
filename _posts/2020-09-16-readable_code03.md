---
title: Readable Code를 읽으며(3)
date: 2020-09-16
categories: readable code
---
## 3편입니다 :)
이미 작성했던 내용을 하나씩 다시 읽다보니 과거 생각이 많이 나네요.  
그땐 이런 책도 많이 찾아 읽고, 어떤 마음가짐을 가져야하나 이런 거에 대해 굉장히 욕구가 많았었는데, 지금은 어느덧 그런 시기는 많이 지나 서비스를 만들고 어떤 코딩을 하고, 어떤식으로 프로젝트를 관리할까 이런쪽으로 고민을 많이하게 되는 것 같습니다.  
지금와서 이런걸 읽는 다는것 자체도 굉장히 신선하고, 새롭게 엔지니어의 길로 접어든 후배님들에게 약간이나마 도움이라도 된다면 좋지 않을까.. 싶은 마음에 아마 이 포스팅은 계속 지속 될 것 같네요 ㅎㅎㅎ  
이번 포스팅에서는 리팩토링과, 메소드를 작성할 때 주의점, 코드의 분량을 줄이는법, 테스트와 가독성에 대한 이야기를 담아볼까 합니다.  

## 상관없는 하위 문제 추출
우리는 문제를 해결 하기 위하여 커다란 문제를 작은 문제들로 쪼갠 다음 각각의 문제에 대한 해결책을 구하고 다시 하나의 해결책으로 맞추는 작업을 한다.  
이러한 원리를 코드에 적용하면 코드는 더 튼튼해지며, 가독성 또한 좋아진다.  

큰 흐름에서 작은 하위 문제를 적극적으로 발견하고 추출하자.
- 주어진 함수나 코드 블록을 보고 스스로에게 질문 해보자
    -상위 수준에서 본 이 코드의 목적은 무엇인가?
- 코드의 무든 행에 질문을 해보자
    - 이 코드는 직접적으로 목적을 위하여 존재하는 것인가? 혹은 목적을 위해 필요하긴 하지만 목적 자체와 직접적으론 상관없는 하위 문제를 해결하는가?

##### 만약 원래의 목적과 직접적으로 관련되지 않은 하위문제를 해결하는 코드의 분량이 많다면, 이를 추출하여 볼도의 함수로 만드는 것이 더 좋다.

SQL 데이터베이스, javascript 라이브러리, html 템플릿 시스템과 같이 사용하는 강력한 라이브러리와 시스템을 생각해보자  
이들의 내부는 염려할 필요가 없다. 이들의 코드 베이스는 프로젝트에서 완전히 분리되어 있다.    
프로젝트에서 사용하는 코드의 더 많은 부분이 별도의 라이브러리로 만들어 질 수록 좋다.  
코드의 나머지가 차지하는 크기가 그만큼 줄어들고 따라서 프로그래머가 생각 해야할 내용도 줄어들기 때문이다.  

##### 상향식(top-down) 프로그래밍
- 가장 상위 수준의 모듈과 함수를 먼저 설계하고, 가장 하위 수준의 기능은 높은 수준을 지우너할 때마다 구현하는 방식

##### 하향식(bottom-up) 프로그래밍
- 모든 하위 문제를 예상하고 구현한 다음, 이러한 조각들을 이용하여 가장 상위 수준의 컴포넌트를 만들어 나가는 방식

가장 이상적인 상황은 수정을 위해 추출해낸 하위 문제는 현재 프로젝트에 대해 아무것도 몰라야 하는 것이다.

한마디로 정리하자면 일반적인 목적의 코드를 프로젝트의 특정 코드에서 분리하라는 것이다.  
일반적인 문제를 해결하기 위한 라이브러리와 헬퍼 함수들로 이루어진 집합을 구성하면, 남아있는 코드는 현재의 프로젝트를 독특하게 만드는 작은 핵심적인 조각이 된다.  
이러한 코딩 기법이 도움을 주는 주된 이유는 프로그래머들이 프로젝트의 나머지 부분에서 분리된, 크기가 작고 잘 정의된 문제에 집중하여 초점을 맞출 수 있는 환경이 구성되기 때문이다.  
결과적으로 이러한 하위 문제의 해결책 자체가 더 완전하고 정확한 결과물을 만들어낼 가능성이 높아진다.  

## 한번에 하나씩
한번에 여러가지 일을 수행하는 코드는 읽기가 어렵다.  
코드 블럭 한나에 새로운 객체를 초기화 하고, 데이터를 청소하고, 입력을 분석하고, 비즈니스 로직을 적용하는 일을 한꺼번에 수행하는 경우도 있다.  
이런 일이 모두 한자리에 모여 있다면 각각의 작업이 별도로 시작되었다 완료되는 경우보다 더욱 더 이해하기 어렵다  

#### 함수는 오직 한가지 작업만 수행해야 한다.
이러한 말은 항상 함수 수준에 머물러야 하는 것은 아니다. 물론 커다란 함수를 여러 작은 함수로 나누는 것은 좋다.  
커다란 함수안에 있는 코드를 재조직하여 그 안에 여러 개의 독자적인 논리적인 영역이 있는 것 처럼 만들 수 있다.
- 코드가 수행하는 모든 작업을 나열 한다.
- 이러한 작업을 분리하여 서로 다른 함수로 혹은, 적어도 논리적으로 구분되는 영역에 놓을 수 있는 코드로 만들어라

이 방법은 필자가 가장 자주 사용하는 방법이다.  
생각 이상으로 코드를 깔끔하게 정렬할 수 있고, 이름까지 역할에 걸맞게 지정해 준다면 이는 이미 가독성에서 50은 먹고 시작한다고 볼 수 있다.  
커다란 흐름 안에서 작게 작게 쪼개어 나가는 것 또한 중요하지만, 작업의 흐름이 쉽게 이해되도록 정리하는 것 또한 중요하다.

## 생각을 코드로 만들어라
> 할머니에게 설명할 수 없다면 당신은 제대로 이해한 것이 아니다  - 아인슈타인 

복잡한 생각을 다른 사람에게 설명할 때 중요하지 않은 자세한 내용 때문에 듣는 사람을 혼동시키는 일이 종종 있을 것이다.  
자신의 생각을 지식이 부족한 사람에게 전달하는 기술은 매우 소중하다.  
설명할 내용을 정리하고 걸러내어 요지만 뽑아내는 능력이 요구된다.  
내용을 잘 이해하게 도울 뿐만 아니라 설명하는 사람 자신도 그 내용을 다시 한 번 명확하게 이해하도록 도와준다.  
작성한 코드를 다른 사람에게 보여줄 때에도 같은 기술이 필요하다.
코드 역시 쉬운말로 작성해야 쉽게 이해 할 수 있는 것이다.
- 코드가 할 일을 옆의 동료에게 말하 듯이 평범한 영어로 작성하라
- 설명에 들어가는  핵심적인 단어와 문구를 포착할 수 있도록 안내하라
- 설명과 부합하는 코드를 작성하라

##### 논리를 명확하게 설명하기
##### 라이브러리를 알면 도움이 된다.
##### 논리를 쉬운 말로 표현하는 방법을 더 큰 문제에 적용해 볼 것

프로그램을 영어로 설명하고, 그 설명으로 더 자연스러운 코드를 작성하는 능력이 필요하다.  
이 테크닉은 믿을 수 없을 정도로 간단하지만 매우 강력한 힘을 낸다. 설명에 사용된 단어와 문구를 살펴보는 것은 코드에서 따로 분리할 수 있는 하위 문제를 파악하는데 큰 도움을 줄 것이다.  
자신의 문제를 쉬운 말로 설명할 수 없다면 해당 문제는 무언가 나사가 하나 빠졌다거나, 아니면 제대로 정의된 것이 아닐 수도 있다.  
어떤 프로그램을 혹은 어떤 생각이라도 말로 설명하는 행위는 문제의 틀을 제대로 잡는데 도움을 준다.

## 코드의 분량을 줄이자.
프로그래머가 배워야 하는 가장 중요한 기술은 언제 코딩을 해야하는지 정확히 인지하고 있는 것이다.
> 가장 쉬운 코드는 아무것도 없는 코드이다.

#### 기능을 구현할려고 애쓰지 마라, 그럴 필요는 없다.
프로그래머는 어떤 기능을 구현하는데 필요한 노력을 과소평가하는 경향도 있다. 조잡한 프로토타입을 구현하는 시간을 지나치게 낙관적으로 예측하고 그 코드를 유지보스 하고, 문서를 만들고, 코드베이스에 새로운 무게를 더하는데 얼마나 많은 시간이 필요한지 자각하지 못한다는 이야기이다.

#### 요구사항에 질문을 던지고 질문을 잘게 나누고 제대로 분석하라
프로그램이 반드시 빠르게 동작하고, 100% 정확하고, 모든 종류의 가능한 입력을 처리해야 하는 것은 아니다.  
주어진 요구사항을 제대로 분석할 수 있다면, 적은 코드로 구현할 수 있는 간단한 문제로 만들 수도 있다.

#### 코드 베이스를 작게 유지하기
프로젝트를 처음 싲가할 때엔 단지 한 두개의 소스 파일만 있으므로 모든게 깔끔하고 훌륭한 상황이다.  
프로젝트가 커지면 디렉토리는 더 많으지고, 소스파일 또한 굉장히 많아진다.  
결과적으로 수 많은 소스코드가 여러 디렉토리에 흩어져 있다. 프로젝트는 거대해지고 전체 프로젝트를 이해하는 사람은 단 한명도 없다.  
새로운 기능을 추가하기도 어렵고, 이러한 코드로 작업을 수행하는 것이 점점 부담스러워지고 불쾌한 일이 되어가고 있다.
- 일반적인 유틸리티를 많이 생성하여 중복된 코드를 제거하자.
- 사용하지 않는 코드 혹은 필요없는 기능을 제거해 나가자
- 프로젝트가 서로 나누어진 하위 프로젝트로 구성되게 하자
- 코드베이스의 무게를 항상 의식하여 가볍고 날렵하게 유지 시키자.

#### 자기 주변에 있는 라이브러리에 친숙해져라
수많은 프로그래머는 이미 존재하는 라이브러리로 자신의 문제를 해결 할 수 있는 상황이 많다는 것을 잘 모르고 있다.  
매일 15분씩이라도 좋으니 표준 라이브러리에 있는 모든 함수/모듈/형 들의 이름을 읽어보자  
생각보다 매우 귀찮지만, 스괍ㄴ이 된다면 코드를 직접 작성하는 대신 우선적으로 이미 존재하는 라이브러리를 사용하는 습관을 가지게 될 것이다.

가급적이면 적은 분량의 코드로 작성하는 방법을 익힐 필요가 있다.  
새로이 작성하는 코드를 모두 테스트하고, 문서화하고, 유지보수해야한다.  
더욱이 코드 베이스에 더 많은 코드가 있따면 더 무거워져 새로운 개발을 더욱더 어렵게 만들 것이다.
- 제품에 꼭 필요하지 않는 기능을 제거하고 과도한 작업을 피한다.
- 요구 사항을 다시 생각하여, 가장 단순한 형태의 문제를 찾아본다.
- 주기적으로 라이브러리 전체 API를 훓어 봄으로 표준 라이브러리와 친숙해져라

## 테스트와 가독성
#### 읽거나 유지보수 하기 쉽게 테스트를 만들어라
테스트 코드가 읽기 쉬우면 사용자는 실제 코드가 어떻게 동작하는지 그만큼 더 이해하기 쉽다.  
다른 프로그래머가 수정하거나 새로운 테스트를 더하는 걸 쉽게 느낄 수 있게 테스트 코드는 읽기 쉬워야 한다.  
만약 그렇지 못하게 된다면...
- 코드를 수정하는 일이 두려워진다. 
- 새로운 테스트를 작성하는데 거부감이 생긴다. 
- 시간이 흐르면 더 낮은 비율의 코드가 테스트가 될 것이다
결과 적으론 테스트 코드에 대한 확신이 줄어들 것이다.  
자신의 코드를 사용하는 사람이 테스트 코드를 편안하게 느끼도록 만들어야 한다. 코드를 사용자는 새로운 코드가 왜 현재 테스트에서 실패하는지 쉽게 전달할 수 있어야 하며, 새로운 테스트 역시 손쉽게 덧 붙일 수 있어야 한다. 

#### 코드를 더 읽기 쉽게 만들기
덜 중요한 세부사항은 사용자가 볼 필요 없게 숨기거나 더 중요한 내용이 눈에 잘 띄게 만들어야 한다.

#### 읽기 편한 메시지 만들기
##### 좋은 테스트 입력값의 선택
가능하다면 가장 간단한 입력을 통해 코드를 완전히 검사할 수 있어야 한다.  
필요한 작업을 수행하는 범위에서 가장 명확하고 간단한 테스트 값을 선택하자.

1. 테스트가 너무 길고 중요하지 않은 내용으로 가득 찼다.
- 테스트가 하는 일을 한 문장으로 표현할 수 있으므로 셀제 테스트로 구문이 지나치게 길 필요는 없다.
2. 새로운 테스트를 추가하기가 쉽지 않다. 복사/붙이기/북사/수정 방법을 쓰고 싶은 유혹을 느끼겠지만, 그렇게 한다면 코드를 더 길고 중복되게 만들 뿐이다.
3. 테스트 실패 메시지가 별로 도움이 되지 않는다. 디버깅에 유용하게 작성될 필요가 있다.
4. 모든 것을 한꺼번에 테스트 하려고 애쓰지마라
5. 테스트 입력은 최대한 간단히 작성하자
6. 테스트 입력값들이 코드를 꼼꼼하게 실행 시키게 해야 한다. 너무 낮은 필터링은 곤란한다.
7. 비어있는 입력 백터, 매우 큰 백터 혹은 중복된 점수와 같이 비정상적인 값을 가지는 입력도 테스트 하는 것이 좋다.
8. 함수 이름에도 신경 써야한다.

#### 테스트에 친숙한 개발
어떤 코드는 다른 코드보다 테스트 하기 더 쉽다. 테스트 하기 좋은 코드는 잘 정의된 인터페이스를 가지고 있으며, 지나치게 많은 상태가 설정을 요구하지 않으며, 감추어진 데이터를 포함하지 않는다.

##### 테스트 주도 개발 (Test Driven Develop)
실제 코드를 작성하기 전에 우선 테스트 코드부터 작성해 나가는 프로그래밍 스타일  
실제 코드를 작성한 다음에 비로소 테스트 코드를 작성하는 방법보다 실제 코드의 질을 상당한 수준으로 향상시킬수 있다.

##### 지나친 테스트
- 테스트를 가능하게 하려고 실제 코드의 가독성을 희생한다.
- 100% 코드 테스트에 집착하는 것
- 사실 코드를 100%테스트 하는 일은 절대 일어나지 않는다. 테스트 되지 않은 버그가 있을 수도 있고, 테스트 되지 않은 기능이 있을수도 있으며, 요구 사항이 달라졌다는 사실을 모르고 있을 수도 있기 때문이다.
- 버그가 야기하는 비용이 어느정도 인지에 따라서, 테스트 코드를 작성하는 시간이 의미를 갖는 부분이 있고, 그렇지 않은 부분도 있기 마련이다.
- 테스트 코드로 실제 제품 개발이 차질을 빛게 되는 악영향도 있다.


## 결론
막상 하나 둘 작성하다보니 데이터가 좀 예전 것도 있고해서 어느정도 가지치기도 감행한 부분이 있습니다.  
이 책에서 이야기하는 부분은 제가 몇 번 언급했듯이, 가볍게 이런 내용이 있구나, 이런식으로 코딩을 할 수도 있구나 식으로 접근하는 것이 좋다고 생각합니다.  
프로젝트가 커질수록 코드의 양은 점점 늘어나고, 이때 새로운 팀원들이 조인하게 되어 코드를 보게 되면 잘 정돈 되어 있을수록 읽기 편하다는 것은 모두가 머리로는 다 알고 있는것 아닐까요??  
